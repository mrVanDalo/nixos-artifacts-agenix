= Directory Layout

The `nixos-artifacts-agenix` backend stores encrypted secrets in a structured directory hierarchy that separates machine-level secrets (NixOS) from user-level secrets (Home Manager).

== Overview

The storage structure follows this pattern:

[source]
----
secrets/
├── per-machine/
│   └── <machineName>/
│       └── <artifactName>/
│           └── <fileName>.age
└── per-user/
    └── <username>/
        └── <artifactName>/
            └── <fileName>.age
----

== Path Components

=== Store Directory

The root directory for all encrypted secrets,
configured via xref:options-nixos.adoc#_artifacts_config_agenix_storedir[storeDir]
and xref:options-nixos.adoc#_artifacts_config_agenix_flakestoredir[flakeStoreDir].

=== Context Directories

==== `per-machine/`

Contains secrets for NixOS system configurations. Each machine has its own subdirectory identified by the hostname.

* Used when: Deploying NixOS system configurations
* Encryption keys: xref:options-nixos.adoc#_artifacts_config_agenix_publichostkey[publicHostKey]
  + optional xref:options-nixos.adoc#_artifacts_config_agenix_publicuserkeys[publicUserKeys]
* Runtime decryption: Automatic using host SSH keys

==== `per-user/`

Contains secrets for Home Manager user configurations. Each user has their own subdirectory.

* Used when: Deploying Home Manager user configurations
* Encryption keys: xref::options-homemanager.adoc#_artifacts_config_agenix_publicuserkeys[publicUserKeys] only
* Runtime decryption: Requires xref::options-homemanager.adoc#_artifacts_config_agenix_identitypaths[identityPaths] configuration

